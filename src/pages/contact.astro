---
import Container from "@/components/container.astro";
import Layout from "@/layouts/Layout.astro";
import { Icon } from "astro-icon/components";

const contactInfo = [
  {
    icon: "lucide:map-pin",
    title: "Visit Us",
    details: ["835 Portion Rd", "Ronkonkoma, NY 11779"],
    link: "https://maps.google.com/?q=835+Portion+Rd+Ronkonkoma+NY+11779",
    linkText: "Get Directions",
  },
  {
    icon: "lucide:phone",
    title: "Call Us",
    details: ["(631) 652-8485"],
    link: "tel:+16316528485",
    linkText: "Call Now",
  },
  {
    icon: "lucide:mail",
    title: "Email Us",
    details: ["nikola@lillianruffpetspa.com"],
    link: "mailto:nikola@lillianruffpetspa.com",
    linkText: "Send Email",
  },
];

const hours = [
  { day: "Tuesday - Thursday", time: "9:00 AM - 9:00 PM" },
  { day: "Friday - Monday", time: "9:00 AM - 5:00 PM" },
];

const socialLinks = [
  { name: "Facebook", url: "https://www.facebook.com/profile.php?id=61568591938836", icon: "lucide:facebook" },
  { name: "Instagram", url: "https://www.instagram.com/lillianruffpetspa/", icon: "lucide:instagram" },
  { name: "TikTok", url: "https://www.tiktok.com/@lillianruffpetspa", icon: "lucide:music" },
  { name: "YouTube", url: "https://youtube.com/@lillianruffpetspa", icon: "lucide:youtube" },
  { name: "LinkedIn", url: "https://www.linkedin.com/company/lillianruffpetspa/", icon: "lucide:linkedin" },
  { name: "Email", url: "mailto:nikola@lillianruffpetspa.com", icon: "lucide:mail" },
];
---

<Layout title="Contact">
  <div class="overflow-x-hidden">
  <!-- Hero Section -->
  <section class="pt-8 pb-16 bg-transparent relative overflow-hidden">
    <Container>
      <div class="text-center max-w-3xl mx-auto">
        <div class="inline-flex items-center gap-2 bg-gradient-to-r from-brand-green/10 to-emerald-100 px-5 py-2.5 rounded-full border border-brand-green/20 mb-6">
          <Icon name="lucide:message-circle" class="w-5 h-5 text-brand-green" />
          <span class="text-sm font-bold text-gray-700 tracking-wider uppercase">Get In Touch</span>
        </div>
        <h1 class="text-4xl md:text-6xl font-black text-gray-900 mb-4">
          We'd Love to
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-green to-emerald-600"> Hear From You</span>
        </h1>
        <p class="text-lg text-gray-600 leading-relaxed">
          Have questions about our grooming services? Want to book an appointment? We're here to help your furry friend look and feel their best!
        </p>
      </div>
    </Container>
  </section>

  <!-- Contact Cards Section -->
  <section class="pb-16 bg-transparent">
    <Container>
      <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
        {contactInfo.map((info) => (
          <div class="group relative rounded-2xl p-6 bg-white/80 backdrop-blur-sm border border-gray-100 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 h-full">
            <div class="flex items-start gap-4 h-full">
              <div class="w-14 h-14 bg-gradient-to-br from-brand-green/10 to-emerald-100 rounded-2xl flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform duration-300">
                <Icon name={info.icon} class="w-7 h-7 text-brand-green" />
              </div>
              <div class="flex flex-col h-full">
                <h3 class="text-xl font-bold text-gray-900 mb-1">{info.title}</h3>
                <div class="flex-grow">
                  {info.details.map((detail) => (
                    <p class="text-gray-600">{detail}</p>
                  ))}
                </div>
                <a
                  href={info.link}
                  target={info.icon === "lucide:map-pin" ? "_blank" : "_self"}
                  rel={info.icon === "lucide:map-pin" ? "noopener noreferrer" : undefined}
                  class="inline-flex items-center gap-2 text-brand-green font-semibold mt-3 hover:gap-3 transition-all duration-300"
                >
                  {info.linkText}
                  <Icon name="lucide:arrow-right" class="w-4 h-4" />
                </a>
              </div>
            </div>
          </div>
        ))}
      </div>
    </Container>
  </section>

  <!-- Main Contact Section -->
  <section class="py-16 bg-transparent">
    <Container>
      <div class="grid lg:grid-cols-2 gap-12 max-w-6xl mx-auto items-stretch">
        <!-- Left Side - Info & Map -->
        <div class="flex flex-col gap-8">
          <!-- Hours Card -->
          <div class="rounded-2xl p-8 bg-gradient-to-br from-brand-green to-emerald-600 text-white shadow-xl flex-1 flex flex-col justify-center">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <Icon name="lucide:clock" class="w-6 h-6" />
              </div>
              <h3 class="text-2xl font-bold">Business Hours</h3>
            </div>
            <div class="space-y-4">
              {hours.map((h) => (
                <div class="flex justify-between items-center py-2 border-b border-white/20 last:border-0">
                  <span class="font-medium">{h.day}</span>
                  <span class="text-white/90">{h.time}</span>
                </div>
              ))}
            </div>
          </div>

          <!-- Social Links -->
          <div class="rounded-2xl p-8 bg-white/80 backdrop-blur-sm border border-gray-100 shadow-lg flex-1 flex flex-col justify-center">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Follow Us</h3>
            <p class="text-gray-600 mb-6">Stay connected and see our adorable clients!</p>
            <div class="flex flex-wrap gap-3">
              {socialLinks.map((social) => (
                <a
                  href={social.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="w-12 h-12 bg-gradient-to-br from-brand-green/10 to-emerald-100 hover:from-brand-green hover:to-emerald-600 rounded-xl flex items-center justify-center text-brand-green hover:text-white transition-all duration-300 hover:-translate-y-1"
                  aria-label={social.name}
                >
                  <Icon name={social.icon} class="w-5 h-5" />
                </a>
              ))}
            </div>
          </div>

          <!-- Quick Book CTA -->
          <div class="rounded-2xl p-8 bg-gradient-to-br from-brand-blue to-sky-600 text-white shadow-xl flex-1 flex flex-col justify-center">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0">
                <Icon name="lucide:calendar-check" class="w-6 h-6" />
              </div>
              <div>
                <h3 class="text-xl font-bold mb-2">Ready to Book?</h3>
                <p class="text-white/90 mb-4">Skip the wait and book your appointment online!</p>
                <a
                  href="https://booking.moego.pet/ol/book?name=LillianRuffPetSpa"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 bg-white text-brand-blue px-6 py-3 rounded-full font-bold hover:-translate-y-1 transition-all duration-300 shadow-lg"
                >
                  <Icon name="lucide:calendar" class="w-5 h-5" />
                  Book Appointment
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Side - Contact Form -->
        <div class="rounded-2xl p-8 bg-white/80 backdrop-blur-sm border border-gray-100 shadow-xl h-full flex flex-col">
          <h3 class="text-2xl font-bold text-gray-900 mb-2">Send Us a Message</h3>
          <p class="text-gray-600 mb-8">Fill out the form below and we'll get back to you as soon as possible.</p>

          <form id="contact-form" class="space-y-6 flex-grow flex flex-col">
            <div class="grid sm:grid-cols-2 gap-6">
              <div>
                <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">Your Name</label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand-green focus:ring-4 focus:ring-brand-green/10 outline-none transition-all duration-300"
                  placeholder="John Doe"
                />
              </div>
              <div>
                <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">Phone Number</label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand-green focus:ring-4 focus:ring-brand-green/10 outline-none transition-all duration-300"
                  placeholder="(555) 123-4567"
                />
              </div>
            </div>

            <div>
              <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand-green focus:ring-4 focus:ring-brand-green/10 outline-none transition-all duration-300"
                placeholder="john@example.com"
              />
            </div>

            <div>
              <label for="pet-name" class="block text-sm font-semibold text-gray-700 mb-2">Pet's Name</label>
              <input
                type="text"
                id="pet-name"
                name="pet-name"
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand-green focus:ring-4 focus:ring-brand-green/10 outline-none transition-all duration-300"
                placeholder="Buddy"
              />
            </div>

            <div>
              <label for="service" class="block text-sm font-semibold text-gray-700 mb-2">Service Interested In</label>
              <select
                id="service"
                name="service"
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand-green focus:ring-4 focus:ring-brand-green/10 outline-none transition-all duration-300 bg-white"
              >
                <option value="">Select a service...</option>
                <option value="grooming">Grooming</option>
                <option value="daycare">DayCare</option>
                <option value="boarding">Boarding</option>
                <option value="products">Products</option>
                <option value="membership">Membership</option>
                <option value="work-with-us">Work With Us</option>
              </select>
            </div>

            <div class="flex-grow flex flex-col">
              <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">Your Message</label>
              <textarea
                id="message"
                name="message"
                rows="4"
                required
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand-green focus:ring-4 focus:ring-brand-green/10 outline-none transition-all duration-300 resize-none flex-grow min-h-[120px]"
                placeholder="Tell us about your pet and what you're looking for..."
              ></textarea>
            </div>

            <button
              type="submit"
              class="w-full flex items-center justify-center gap-2 bg-brand-green text-white px-8 py-4 rounded-xl font-bold hover:bg-emerald-600 hover:-translate-y-1 transition-all duration-300 shadow-lg shadow-brand-green/25"
            >
              <Icon name="lucide:send" class="w-5 h-5" />
              Send Message
            </button>
          </form>

          <div id="form-result" class="mt-4 text-center hidden"></div>
        </div>
      </div>
    </Container>
  </section>

  <!-- Map Section -->
  <section class="py-16 bg-transparent">
    <Container>
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-2">Find Us</h2>
          <p class="text-gray-600">Located in Ronkonkoma, NY</p>
        </div>
        <div class="rounded-2xl overflow-hidden shadow-xl border border-gray-100">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3021.5!2d-73.12!3d40.82!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89e8388e8e8e8e8e%3A0x8e8e8e8e8e8e8e8e!2s835%20Portion%20Rd%2C%20Ronkonkoma%2C%20NY%2011779!5e0!3m2!1sen!2sus!4v1234567890"
            width="100%"
            height="400"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            class="w-full"
          ></iframe>
        </div>
      </div>
    </Container>
  </section>

  <!-- Bottom Spacer -->
  <div style="height: 20px;"></div>
  </div>
</Layout>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const result = document.getElementById('form-result') as HTMLElement;
  const phoneInput = document.getElementById('phone') as HTMLInputElement;

  // Format phone number as user types: (555) 123-4567
  function formatPhoneNumber(value: string): string {
    const digits = value.replace(/\D/g, '');
    if (digits.length === 0) return '';
    if (digits.length <= 3) return `(${digits}`;
    if (digits.length <= 6) return `(${digits.slice(0, 3)}) ${digits.slice(3)}`;
    return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6, 10)}`;
  }

  phoneInput?.addEventListener('input', (e) => {
    const input = e.target as HTMLInputElement;
    const cursorPos = input.selectionStart || 0;
    const oldLength = input.value.length;
    input.value = formatPhoneNumber(input.value);
    const newLength = input.value.length;
    const newCursorPos = cursorPos + (newLength - oldLength);
    input.setSelectionRange(newCursorPos, newCursorPos);
  });

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);

      // Build JSON payload
      const payload = {
        name: formData.get('name'),
        phone: formData.get('phone'),
        email: formData.get('email'),
        petName: formData.get('pet-name'),
        service: formData.get('service'),
        message: formData.get('message'),
      };

      // Show sending state
      result.classList.remove('hidden');
      result.innerHTML = '<span class="text-gray-600">Sending message...</span>';

      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload),
        });

        const data = await response.json();

        if (data.success) {
          result.innerHTML = '<span class="text-green-600 font-semibold">Thank you! We\'ll get back to you soon.</span>';
          form.reset();
        } else {
          result.innerHTML = '<span class="text-red-500 font-semibold">Something went wrong. Please try again.</span>';
        }
      } catch (error) {
        result.innerHTML = '<span class="text-red-500 font-semibold">Something went wrong. Please try again.</span>';
      }

      setTimeout(() => {
        result.classList.add('hidden');
      }, 5000);
    });
  }
</script>
