---
import { getCollection } from "astro:content";
import { Picture } from "astro:assets";
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/container.astro";
import { Icon } from "astro-icon/components";

// Generate a new path for every collection entry
export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

// Get the entry directly from the prop on render
const { entry } = Astro.props;
const { Content } = await entry.render();

// Format date nicely
function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<Layout title={entry.data.title}>
  <article>
    <!-- Hero Section -->
    <section class="pt-8 pb-8 bg-transparent">
      <Container>
        <div class="max-w-4xl mx-auto">
          <!-- Back button -->
          <a
            href="/blog"
            class="inline-flex items-center gap-2 text-gray-600 hover:text-brand-green transition-colors mb-8 group"
          >
            <Icon name="lucide:arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform" />
            <span class="text-sm font-medium">Back to Blog</span>
          </a>

          <!-- Category badge -->
          <div class="flex items-center gap-2 mb-4">
            <span class="inline-flex items-center gap-1 bg-brand-green/10 text-brand-green px-4 py-1.5 rounded-full text-sm font-bold uppercase tracking-wide">
              {entry.data.category}
            </span>
          </div>

          <!-- Title -->
          <h1 class="text-3xl md:text-5xl font-black text-gray-900 mb-6 leading-tight">
            {entry.data.title}
          </h1>

          <!-- Meta info -->
          <div class="flex flex-wrap items-center gap-4 pb-8 border-b border-gray-200">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-brand-green to-emerald-500 rounded-full flex items-center justify-center">
                <Icon name="lucide:user" class="w-5 h-5 text-white" />
              </div>
              <div>
                <p class="font-semibold text-gray-900">{entry.data.author}</p>
                <time class="text-sm text-gray-500" datetime={entry.data.publishDate.toISOString()}>
                  {formatDate(entry.data.publishDate)}
                </time>
              </div>
            </div>

            <!-- Tags -->
            <div class="flex flex-wrap gap-2 ml-auto">
              {entry.data.tags.map((tag) => (
                <span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                  #{tag}
                </span>
              ))}
            </div>
          </div>
        </div>
      </Container>
    </section>

    <!-- Featured Image -->
    <section class="pb-8">
      <Container>
        <div class="max-w-4xl mx-auto">
          <div class="rounded-3xl overflow-hidden shadow-xl">
            <Picture
              src={entry.data.image.src}
              alt={entry.data.image.alt}
              sizes="(max-width: 1200px) 100vw, 1200px"
              width={1200}
              height={600}
              class="w-full h-auto object-cover"
            />
          </div>
        </div>
      </Container>
    </section>

    <!-- Content -->
    <section class="pb-16">
      <Container>
        <div class="mx-auto prose prose-lg max-w-3xl prose-headings:text-gray-900 prose-headings:font-bold prose-p:text-gray-600 prose-p:leading-relaxed prose-a:text-brand-green prose-a:no-underline hover:prose-a:underline prose-strong:text-gray-900 prose-ul:text-gray-600 prose-ol:text-gray-600 prose-li:marker:text-brand-green">
          <Content />
        </div>
      </Container>
    </section>

    <!-- Bottom CTA -->
    <section class="pb-20">
      <Container>
        <div class="max-w-3xl mx-auto">
          <div class="rounded-3xl p-8 md:p-10 bg-gradient-to-br from-brand-green to-emerald-600 text-white text-center">
            <div class="w-16 h-16 mx-auto bg-white/20 rounded-2xl flex items-center justify-center mb-4">
              <Icon name="lucide:sparkles" class="w-8 h-8" />
            </div>
            <h3 class="text-2xl md:text-3xl font-bold mb-3">Ready to Pamper Your Pet?</h3>
            <p class="text-white/90 mb-6 max-w-lg mx-auto">
              Book a grooming appointment today and give your furry friend the spa treatment they deserve.
            </p>
            <a
              href="/grooming"
              class="inline-flex items-center gap-2 bg-white text-brand-green px-8 py-4 rounded-full font-bold hover:-translate-y-1 transition-all duration-300 shadow-lg"
            >
              <Icon name="lucide:calendar" class="w-5 h-5" />
              Book an Appointment
            </a>
          </div>
        </div>
      </Container>
    </section>

    <!-- More Posts -->
    <section class="pb-20">
      <Container>
        <div class="max-w-3xl mx-auto text-center">
          <a
            href="/blog"
            class="inline-flex items-center gap-2 bg-gray-100 text-gray-700 px-6 py-3 rounded-full font-semibold hover:bg-gray-200 transition-colors"
          >
            <Icon name="lucide:arrow-left" class="w-4 h-4" />
            View All Posts
          </a>
        </div>
      </Container>
    </section>
  </article>
</Layout>
